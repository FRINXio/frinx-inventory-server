generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Source {
  MANUAL
  DISCOVERED
  IMPORTED
}

enum ServiceState {
  PLANNING
  IN_SERVICE
  OUT_OF_SERVICE
}

model device {
  id              String        @id @default(uuid())
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  name            String        @db.VarChar(255)
  role            String?       @db.VarChar(50)
  managementIp    String?       @map("management_ip") @db.Inet
  config          Json?         @db.Json
  model           String?       @db.VarChar(255)
  software        String?       @db.VarChar(50)
  softwareVersion String?       @map("sw_version") @db.VarChar(50)
  macAddress      String?       @map("mac_address")
  serialNumber    String?       @map("serial_number") @db.VarChar(50)
  vendor          String?       @db.VarChar(50)
  mountParameters Json?         @map("mount_parameters")
  username        String?       @db.VarChar(50)
  password        String?       @db.VarChar(50)
  tenantId        String        @map("tenant_id") @db.VarChar(64)
  uniconfigZoneId String        @map("uniconfig_zone")
  uniconfigZone   uniconfigZone @relation(fields: [uniconfigZoneId], references: [id])
  source          Source
  serviceState    ServiceState  @default(PLANNING)
  locationId      String?       @map("location_id")
  location        location?     @relation(fields: [locationId], references: [id])

  label deviceLabel[]

  @@unique([name, tenantId], name: "udx_device_name_tenant_id")
  @@map("device_inventory")
}

model uniconfigZone {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  name      String   @db.VarChar(250)
  tenantId  String   @map("tenant_id") @db.VarChar(64)
  device    device[]



  @@unique([name, tenantId], name: "udx_uniconfig_zone_name_tenant_id")
  @@index([tenantId], name: "idx_uniconfig_zone_tenant_id")
  @@map("uniconfig_zone")
}

model label {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  name      String
  tenantId  String   @map("tenant_id")

  device deviceLabel[]
  @@unique([name, tenantId], name: "udx_label_name_tenant_id")
}

model deviceLabel {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deviceId  String   @map("device_id")
  labelId   String   @map("label_id")

  device device @relation(fields: [deviceId], references: [id])
  label  label  @relation(fields: [labelId], references: [id])


  @@unique([deviceId, labelId], name: "udx_device_label_device_id_label_id")
  @@map("device_label")
}

model location {
  id                 String   @id @default(uuid())
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  name               String
  tenantId           String   @map("tenant_id")
  latitude           String?
  longitude          String?
  addressLine1       String?  @map("address_line_1")
  addressLine2       String?  @map("address_line_2")
  zipCode            String?  @map("zip_code")
  sortingCode        String?  @map("sorting_code")
  dependentLocality  String?  @map("dependent_locality")
  locality           String?
  administrativeArea String?  @map("administrative_area") // city
  country            String   @map("country")
  device             device[]

  @@unique([name, tenantId], name: "udx_location_name_tenant_id")
}
